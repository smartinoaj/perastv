<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Peras TV</title>
  <link rel="icon" type="image/png" href="ptv.png">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700&display=swap" rel="stylesheet">
  <!-- HLS.js for .m3u8 playback -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body { margin:0; padding:0; background:#0e0e11; color:#ffffff; font-family:Arial,sans-serif; }
    h1 { text-align:center; padding:20px; margin-bottom:2px; font-size:2.5em; font-family:'Nunito',sans-serif; }
    .tabs { display:flex; justify-content:center; gap:10px; margin-bottom:20px; flex-wrap:wrap; }
    .tab-button { background:#1e1e22; color:white; border:none; padding:10px 20px; cursor:pointer; border-radius:8px; font-size:1em; }
    .tab-button.active { background:#cc2e2e; }
    .channel-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(300px,1fr)); gap:20px; padding:0 20px 40px; max-width:1200px; margin:0 auto; }
    .channel-box { background:#1e1e22; padding:15px; border-radius:8px; cursor:pointer; position:relative; text-align:center; }
    .iframe-container { display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:#000; padding:10px; box-sizing:border-box; }
    .iframe-container iframe, .iframe-container video { width:100%; height:100%; border:none; border-radius:8px; }
    .stream-buttons { margin-top:10px; display:flex; flex-wrap:wrap; gap:5px; justify-content:center; }
    .stream-buttons button { background:#333; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer; }
    .stream-buttons button.active { background:#cc2e2e; color:#000; }
    /* password screen, shake animation, footer styles, etc. remain unchanged */
  </style>
</head>
<body>
  <!-- Password Screen -->
  <div id="passwordScreen" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#0e0e11;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999;">
    <h2 style="color:white;font-family:'Nunito',sans-serif;">Enter Password</h2>
    <input type="password" id="passwordInput" style="padding:10px;font-size:1em;border-radius:5px;border:none;margin:10px;">
    <button style="padding:10px 20px;font-size:1em;border:none;background-color:#cc2e2e;color:white;border-radius:5px;cursor:pointer;">Enter</button>
    <p id="errorMessage" style="color:red;margin-top:10px;display:none;">Incorrect Password!</p>
  </div>

  <!-- Header & Tabs -->
  <h1><img src="ptvlogo.png" alt="PERAS TV" style="max-width:250px;height:auto;"></h1>
  <div class="tabs">
    <button class="tab-button active" onclick="showTab(event,'PT')">PT</button>
    <button class="tab-button" onclick="showTab(event,'UK')">UK</button>
    <button class="tab-button" onclick="showTab(event,'ES')">ES</button>
    <button class="tab-button" onclick="showTab(event,'Matches')">Matches</button>
  </div>

  <!-- Channel Grids -->
  <div id="PT" class="channel-grid"></div>
  <div id="UK" class="channel-grid" style="display:none;"></div>
  <div id="ES" class="channel-grid" style="display:none;"></div>
  <div id="Matches" class="channel-grid" style="display:none;"></div>

  <script>
    // Global HLS.js instance
    let hls = null;

    // Fetch and render channels
    fetch('channels.json').then(r => r.json()).then(data => {
      renderChannels('PT', data.PT);
      renderChannels('UK', data.UK);
      renderChannels('ES', data.ES);
    });
    fetch('matches.json').then(r => r.json()).then(renderMatchChannels);

    function renderChannels(tab, channels) {
      const grid = document.getElementById(tab);
      grid.innerHTML = '';
      channels.forEach(ch => {
        const box = document.createElement('div');
        box.className = 'channel-box';
        box.innerHTML = `
          <h3>${ch.name}</h3>
          <div class="iframe-container">
            <iframe allow="autoplay; fullscreen" style="display:none;"></iframe>
            <video controls autoplay muted playsinline style="display:none;"></video>
            <div class="stream-buttons">
              ${ch.srcs.map(u => `<button onclick="changeStream(event,this,'${u}')">â–¶</button>`).join('')}
            </div>
          </div>`;
        box.onclick = () => toggleIframe(box);
        grid.appendChild(box);
      });
    }

    function renderMatchChannels(matches) {
      const grid = document.getElementById('Matches');
      grid.innerHTML = '';
      matches.forEach(m => {
        const box = document.createElement('div');
        box.className = 'channel-box';
        box.innerHTML = `
          <div style="display:flex;align-items:center;justify-content:center;gap:10px;">
            <img src="${m.logo1}" alt="" style="height:30px;">
            <h3>${m.team1} X ${m.team2}</h3>
            <img src="${m.logo2}" alt="" style="height:30px;">
          </div>
          <p class="match-time">${m.time}</p>
          <div class="iframe-container">
            <iframe allow="autoplay; fullscreen" style="display:none;"></iframe>
            <video controls autoplay muted playsinline style="display:none;"></video>
            <div class="stream-buttons">
              ${m.pt.map(u => `<button onclick="changeStream(event,this,'${u}')">PT</button>`).join('')}
              ${m.uk.map(u => `<button onclick="changeStream(event,this,'${u}')">UK</button>`).join('')}
              ${m.es.map(u => `<button onclick="changeStream(event,this,'${u}')">ES</button>`).join('')}
            </div>
          </div>`;
        box.onclick = () => toggleIframe(box);
        grid.appendChild(box);
      });
    }

    function toggleIframe(box) {
      // Collapse all
      document.querySelectorAll('.channel-box').forEach(b => {
        b.classList.remove('expanded');
        const c = b.querySelector('.iframe-container');
        c.style.display = 'none';
        c.querySelector('iframe').src = '';
        c.querySelector('video').src = '';
      });
      // Expand this one
      box.classList.add('expanded');
      const grid = box.parentElement;
      grid.prepend(box);
      const container = box.querySelector('.iframe-container');
      container.style.display = 'block';
      // Auto-click first button
      const btn = container.querySelector('.stream-buttons button');
      if (btn) btn.click();
    }

    function changeStream(e, btn, url) {
      e.stopPropagation();
      const container = btn.closest('.iframe-container');
      const iframe = container.querySelector('iframe');
      const video  = container.querySelector('video');

      // Cleanup old HLS
      if (hls) { hls.destroy(); hls = null; }

      // Hide both
      iframe.style.display = 'none';
      video.style.display  = 'none';
      iframe.src = '';
      video.src  = '';

      if (url.toLowerCase().endsWith('.m3u8')) {
        // HLS.js path
        video.style.display = 'block';
        if (Hls.isSupported()) {
          hls = new Hls();
          hls.loadSource(url);
          hls.attachMedia(video);
          hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        }
        else if (video.canPlayType('application/vnd.apple.mpegurl')) {
          video.src = url;
          video.addEventListener('loadedmetadata', () => video.play());
        }
      } else {
        // iframe path
        iframe.src = url;
        iframe.style.display = 'block';
      }

      // Button active state
      container.querySelectorAll('.stream-buttons button')
               .forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }

    function showTab(ev, id) {
      document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
      ev.target.classList.add('active');
      document.querySelectorAll('.channel-grid').forEach(g => g.style.display = 'none');
      document.getElementById(id).style.display = (id === 'Matches' ? 'flex' : 'grid');
    }
  </script>

  <!-- Password logic and last-updated footer remain exactly as in your original file -->

</body>
</html>
